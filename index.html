<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Выбор камеры и управление масштабом</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 1rem;
  }
  video {
    width: 100%;
    max-width: 400px;
    border: 1px solid #ccc;
    margin-bottom: 1rem;
    transform-origin: center center;
  }
  label, select, input {
    display: block;
    margin-bottom: 1rem;
    max-width: 320px;
  }
</style>
</head>
<body>

<h1>Выбор камеры и управление масштабом</h1>

<label for="camera-select">Выберите камеру:</label>
<select id="camera-select"></select>

<label for="zoom-range">Масштаб (Zoom): <span id="zoom-value">1</span>x</label>
<input type="range" id="zoom-range" min="1" max="3" step="0.1" value="1" disabled />

<video id="video" autoplay playsinline></video>

<script>
  const video = document.getElementById('video');
  const cameraSelect = document.getElementById('camera-select');
  const zoomRange = document.getElementById('zoom-range');
  const zoomValue = document.getElementById('zoom-value');

  let currentStream;

  // Получить список камер
  async function getCameras() {
    try {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const videoDevices = devices.filter(device => device.kind === 'videoinput');

      cameraSelect.innerHTML = '';
      videoDevices.forEach((device, index) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.textContent = device.label || `Камера ${index + 1}`;
        cameraSelect.appendChild(option);
      });

      if (videoDevices.length > 0) {
        startStream(videoDevices[0].deviceId);
      }
    } catch (err) {
      alert('Ошибка при получении камер: ' + err.message);
    }
  }

  // Запустить поток с выбранной камерой
  async function startStream(deviceId) {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
    }

    try {
      const constraints = {
        video: {
          deviceId: { exact: deviceId },
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };

      currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = currentStream;

      // Проверим поддержку zoom и активируем ползунок, если возможно
      const [videoTrack] = currentStream.getVideoTracks();
      const capabilities = videoTrack.getCapabilities();

      if (capabilities.zoom) {
        zoomRange.min = capabilities.zoom.min;
        zoomRange.max = capabilities.zoom.max;
        zoomRange.step = capabilities.zoom.step || 0.1;
        zoomRange.value = capabilities.zoom.min;
        zoomRange.disabled = false;
      } else {
        zoomRange.disabled = true;
        zoomRange.value = 1;
      }
      zoomValue.textContent = zoomRange.value;
    } catch (err) {
      alert('Ошибка при запуске камеры: ' + err.message);
    }
  }

  // При смене камеры
  cameraSelect.addEventListener('change', () => {
    startStream(cameraSelect.value);
  });

  // При изменении зума
  zoomRange.addEventListener('input', () => {
    zoomValue.textContent = zoomRange.value;

    if (!currentStream) return;

    const [videoTrack] = currentStream.getVideoTracks();
    const constraints = {
      advanced: [{ zoom: zoomRange.value }]
    };

    videoTrack.applyConstraints(constraints).catch(e => {
      console.warn('Не удалось применить масштаб:', e);
      // Если не поддерживается, можно имитировать zoom через CSS:
      // video.style.transform = `scale(${zoomRange.value})`;
    });
  });

  getCameras();
</script>

</body>
</html>
